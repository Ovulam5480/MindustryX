From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: way-zer <himc.wicp@gmail.com>
Date: Thu, 28 Mar 2024 22:21:07 +0800
Subject: [PATCH] UI: Settings

---
 core/assets/bundles/bundle-mdtx.properties | 45 +++++++++++--------
 core/src/mindustryX/Hooks.java             |  3 ++
 core/src/mindustryX/features/Settings.java | 50 ++++++++++++++++++++++
 3 files changed, 81 insertions(+), 17 deletions(-)
 create mode 100644 core/src/mindustryX/features/Settings.java

diff --git a/core/assets/bundles/bundle-mdtx.properties b/core/assets/bundles/bundle-mdtx.properties
index 1ac2f7d9dc63e7a955c8a1a3b80017ad857f406d..6840525f321cc6a72bc873c119dcd5ea5e4b15d4 100644
--- a/core/assets/bundles/bundle-mdtx.properties
+++ b/core/assets/bundles/bundle-mdtx.properties
@@ -41,6 +41,34 @@ stat.ammo_capacity = 子弹容量
 
 #end StatExt
 
+# Settings
+settings.category.mindustryX = MindustryX扩展
+setting.showUpdateDialog.name = 检测到新版MindustryX时提示
+setting.githubMirror.name = GitHub镜像加速(WZ镜像)    [gray]优化全球服务器列表及Mod浏览器功能
+
+category.arcReWork.name = Arc功能重置
+setting.replayRecord.name = 多人游戏录像    [gray]自动录制游玩过程，输出在saves文件夹
+setting.menuFloatText.name = 首页悬浮文字
+setting.showAdvanceToolTable.name = 工具箱(物品选择区左边)
+setting.researchViewer.name = 科技树透视器
+setting.minimapSize.name = 小地图大小
+setting.maxSchematicSize.name = 最大蓝图大小
+
+category.blockSettings.name = 建筑相关设置
+setting.staticShieldsBorder.name = 静止力墙边界
+setting.arcTurretPlaceCheck.name = [pink]炮台[white]：范围检查
+setting.arcchoiceuiIcon.name = [acid]装卸|分类[white]：显示物品图标
+setting.HiddleItemTransparency.name = [acid]带桥/交叉器内物品[white]：不透明度
+setting.overdrive_zone.name = [acid]超速范围[white]：不透明度
+setting.arcPlacementEffect.name = [pink]建筑放置特效
+setting.blockbarminhealth.name = [acid]建筑属性显示[white]：血量最低限制
+setting.blockRenderLevel.name = [cyan]建筑渲染等级
+
+category.entitySettings.name = 实体相关设置
+setting.bulletShow.name = 显示子弹
+setting.showminebeam.name = 显示单位挖掘光束
+#end Settings
+
 stat.reloadDetail = 装填：{0}%
 stat.warmupDetail = 充能：{0}%
 stat.ammoDetail = 弹药：{0}/{1}
@@ -391,7 +419,6 @@ achievement.useAnimdustryEmoji.desc = 在多人聊天中使用:alphachan:表情
 setting.blockreplace.name = 允许覆盖建筑
 
 category.arcCAssist.name = 辅助功能
-setting.maxSchematicSize.name = [acid]蓝图大小
 setting.crashreport.name = 发送匿名的崩溃报告
 
 category.arcCOverview.name = 全局设置
@@ -399,14 +426,12 @@ setting.uiscale.name = UI缩放比例   [orange][重启生效]
 
 category.arcCgamewindow.name = 游戏界面
 setting.override_boss_shown.name = [cyan]boss血条[orange][重启生效]
-setting.minimapSize.name = [acid]小地图[white]：大小
 setting.minimapTools.name = [acid]小地图[white]：工具箱
 
 category.arcCgameview.name = 游戏画面
 setting.alwaysshowdropzone.name = [cyan]刷怪点
 setting.showFlyerSpawn.name = [cyan]空军刷怪点
 setting.showFlyerSpawnLine.name = [cyan]空军刷怪点连线
-setting.HiddleItemTransparency.name = [acid]带桥/交叉器内物品[white]：不透明度
 
 category.arcCGraphicsOther.name = 其他
 
@@ -418,7 +443,6 @@ setting.changelogexplain.name = [acid]学术端改动内容非常多，为防止
 
 category.arcHudToolbox.name = 主游戏界面
 setting.AuxiliaryTable.name = [acid]辅助器     [orange][重启生效]
-setting.showAdvanceToolTable.name = [acid]工具箱
 setting.arccoreitems.name = [acid]arc核心物资   [gray]点击电量条
 setting.arcCoreItemsCol.name = [acid]arc核心物资列数
 setting.powerStatistic.name = [acid]电量统计     [orange][重启生效]
@@ -431,18 +455,14 @@ setting.hoveredTileInfo.name = [acid]显示鼠标指针地块/建筑名称
 setting.arcAlwaysTeamColor.name = [acid]玩家列表[white]：总是绘制队伍颜色
 
 category.arcAddBlockInfo.name = 更多建筑属性
-setting.overdrive_zone.name = [acid]超速范围[white]：不透明度
 setting.mend_zone.name = [acid]修复范围[white]：不透明度
 setting.blockdisabled.name = [cyan]建筑禁用显示
 setting.blockBars.name = [acid]建筑属性
-setting.blockbarminhealth.name = [acid]建筑属性显示[white]：血量最低限制
 setting.blockBars_mend.name = [acid]修复[white]：进度条
 setting.arcdrillmode.name = [acid]钻头[white]：常亮矿物
 setting.arcDrillProgress.name = [acid]钻头[white]：显示挖掘进度      [gray]只推荐mod下使用
-setting.arcchoiceuiIcon.name = [acid]装卸|分类[white]：显示物品图标
 setting.arclogicbordershow.name = [acid]显示屏与画板[white]：边框       [gray]关闭后多个显示屏会更好得拼接在一起
 setting.oneBlockProperty.name = [acid]复制单个建筑时展示属性       [orange]无需要不建议开启，会导致属性丢失
-setting.arcPlacementEffect.name = [pink]建筑放置特效
 
 category.arcMassDriverInfo.name = 质驱引导线
 setting.mass_driver_line_alpha.name = [acid]质驱引导线[white]：不透明度
@@ -453,7 +473,6 @@ category.arcAddTurretInfo.name = 更多炮台属性
 setting.showTurretAmmo.name = [acid]炮台[white]：子弹类型
 setting.showTurretAmmoAmount.name = [acid]炮台[white]：子弹数量
 setting.arcTurretPlacementItem.name = [pink]炮台[white]：弹药射界
-setting.arcTurretPlaceCheck.name = [pink]炮台[white]：范围检查
 setting.turretAlertRange.name = [acid]炮台[white]：警告范围
 setting.turretForceShowRange.name = [acid]炮台[white]：强制显示射程  [gray]可用于在编辑器下显示射程
 setting.turretShowRange.name = [acid]炮台[white]：射程
@@ -469,7 +488,6 @@ setting.unitBarDrawMinHealth.name = [acid]单位属性[white]：最低血量
 setting.unitWeaponRangeAlpha.name = [acid]单位武器射程[white]：不透明度
 setting.unitWeaponRange.name = [acid]单位武器射程[white]：范围警告
 setting.unitWeaponTargetLine.name = [acid]单位武器目标
-setting.showminebeam.name = [cyan]单位挖掘光束
 setting.unitItemCarried.name = [acid]单位携带的物品
 setting.unithitbox.name = [acid]单位碰撞箱
 setting.unitLogicMoveLine.name = [acid]控制[white]：移动路径
@@ -504,24 +522,18 @@ setting.arcDisableModWarning.name = [orange]我已知晓且同意学术端的mod
 setting.menuFlyersCount.name = 首页兵种数量调整
 setting.menuFlyersRange.name = 首页兵种显示射界
 setting.menuFlyersFollower.name = 首页兵种小弟模式
-setting.menuFloatText.name = 首页悬浮文字
-setting.showUpdateDialog.name = 检测到新版学术时弹窗
 
 settings.forcehide = [orange]帧率重调装置
 category.arcCDisplayBlock.name = 建筑显示
-setting.blockRenderLevel.name = [cyan]建筑渲染等级
 setting.displayblock.name = [cyan]工厂方块
 
 category.arcCDisplayEffect.name = 特效与效果
-setting.bulletShow.name = [acid]子弹
 setting.forceEnableDarkness.name = [cyan]厚墙体阴影
-setting.staticShieldsBorder.name = [cyan]静止力墙边界
 setting.limitupdate.name = [cyan]限制更新
 setting.limitdst.name = [cyan]视角外更新范围
 
 settings.specmode = [acid]更多内容适配
 category.moreContent.name = 更多内容适配
-setting.githubMirror.name = [cyan]GitHub镜像加速(WZ镜像)    [gray]优化全球服务器列表及Mod浏览器功能
 setting.itemSelectionHeight.name = [cyan]建筑选择框行数
 setting.itemSelectionWidth.name = [cyan]建筑选择框列数
 setting.blockInventoryWidth.name = [cyan]建筑物品栏每行物品数
@@ -536,7 +548,6 @@ setting.yuanshen.name = [cyan]原神，启动！
 setting.xibaoOnKick.name = [cyan]被踢出游戏时显示[gold]喜报
 category.specGameMode.name = 更多游戏功能
 setting.autoSelSchematic.name = [cyan]蓝图自动选择器      [orange]自动筛选包含选中物品的蓝图
-setting.researchViewer.name = [cyan]科技树透视器  [orange][重启生效]
 setting.arcShareMedia.name = 允许接受服务器及玩家发送的音乐和图片
 setting.rotateCanvas.name = 蓝图旋转时会旋转画板内容 [orange]可能导致崩溃，小心使用
 setting.developMode.name = [red]开发者模式  [orange]不完善|测试中的功能，普通用户请不要打开。欢迎提出修复方案
diff --git a/core/src/mindustryX/Hooks.java b/core/src/mindustryX/Hooks.java
index 55726251ff2a3a52f6bfd71da8f962bf5c936159..62f2f4e532df212b24231d4af2506980855466d2 100644
--- a/core/src/mindustryX/Hooks.java
+++ b/core/src/mindustryX/Hooks.java
@@ -5,6 +5,7 @@ import arc.util.*;
 import mindustry.*;
 import mindustry.gen.*;
 import mindustryX.features.*;
+import mindustryX.features.Settings;
 
 import java.net.*;
 
@@ -12,6 +13,7 @@ public class Hooks implements ApplicationListener{
     /** invoke before `Vars.init`. Note that may be executed from `Vars.loadAsync` */
     public static void beforeInit(){
         Log.infoTag("MindustryX", "Hooks.beforeInit");
+        Settings.baseSettings();
     }
 
     /** invoke after loading, just before `Mod::init` */
@@ -20,6 +22,7 @@ public class Hooks implements ApplicationListener{
         Log.infoTag("MindustryX", "Hooks.init");
         RenderExt.init();
         ArcOld.addSettings();
+        Settings.addSettings();
         if(AutoUpdate.INSTANCE.getActive())
             AutoUpdate.INSTANCE.checkUpdate();
         if(!Vars.headless){
diff --git a/core/src/mindustryX/features/Settings.java b/core/src/mindustryX/features/Settings.java
new file mode 100644
index 0000000000000000000000000000000000000000..c19b9836960ef27f92347f2b6876e5726ed67ee5
--- /dev/null
+++ b/core/src/mindustryX/features/Settings.java
@@ -0,0 +1,50 @@
+package mindustryX.features;
+
+import arc.*;
+import mindustry.*;
+import mindustry.gen.*;
+
+import static mindustry.Vars.maxSchematicSize;
+
+public class Settings{
+    public static void baseSettings(){
+        int v = Core.settings.getInt("maxSchematicSize");
+        maxSchematicSize = v == 257 ? Integer.MAX_VALUE : v;
+    }
+    public static void addSettings(){
+        var setting = Vars.ui.settings;
+        setting.addCategory("@settings.category.mindustryX", Icon.box, (c) -> {
+            c.checkPref("showUpdateDialog", true);
+            c.checkPref("githubMirror", false);
+
+            c.addCategory("arcReWork");
+            c.checkPref("replayRecord", false);
+            c.checkPref("menuFloatText", true);
+            c.checkPref("showAdvanceToolTable", false);
+            c.checkPref("researchViewer", false);
+            c.sliderPref("minimapSize", 140, 40, 400, 10, i -> i + "");
+            c.sliderPref("maxSchematicSize", 32, 32, 257, 1, v -> {
+                maxSchematicSize = v == 257 ? Integer.MAX_VALUE : v;
+                return v == 257 ? "无限" : String.valueOf(v);
+            });
+
+            c.addCategory("blockSettings");
+            c.checkPref("staticShieldsBorder", false);
+            c.checkPref("arcTurretPlaceCheck", false);
+            c.checkPref("arcchoiceuiIcon", false);
+            c.sliderPref("HiddleItemTransparency", 0, 0, 100, 2, i -> i > 0 ? i + "%" : "关闭");
+            c.sliderPref("overdrive_zone", 0, 0, 100, 2, i -> i > 0 ? i + "%" : "关闭");
+            c.checkPref("arcPlacementEffect", false);
+            c.sliderPref("blockbarminhealth", 0, 0, 4000, 50, i -> i + "[red]HP");
+            c.sliderPref("blockRenderLevel", 2, 0, 2, 1, s -> {
+                if(s > 1) return "全部显示";
+                if(s > 0) return "只显示建筑状态";
+                return "隐藏全部建筑";
+            });
+
+            c.addCategory("entitySettings");
+            c.checkPref("bulletShow", true);
+            c.checkPref("showMineBeam".toLowerCase(), true);
+        });
+    }
+}

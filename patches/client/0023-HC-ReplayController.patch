From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: way-zer <himc.wicp@gmail.com>
Date: Wed, 20 Mar 2024 23:51:15 +0800
Subject: [PATCH] HC: ReplayController
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

兼容ARC的mrep格式
way-zer <himc.wicp@gmail.com> on 2024/4/22 at 18:10

实现功能按钮
way-zer <himc.wicp@gmail.com> on 2024/4/22 at 20:15
---
 core/src/mindustry/core/NetClient.java | 3 +++
 core/src/mindustry/net/Net.java        | 2 ++
 2 files changed, 5 insertions(+)

diff --git a/core/src/mindustry/core/NetClient.java b/core/src/mindustry/core/NetClient.java
index de725eefa2243af7ac9c6fa78955a06b96737205..6f24e15192491a31258658dfa8ad843ac580e56b 100644
--- a/core/src/mindustry/core/NetClient.java
+++ b/core/src/mindustry/core/NetClient.java
@@ -25,6 +25,7 @@ import mindustry.net.Packets.*;
 import mindustry.world.*;
 import mindustry.world.modules.*;
 import mindustryX.*;
+import mindustryX.features.*;
 
 import java.io.*;
 import java.util.*;
@@ -105,12 +106,14 @@ public class NetClient implements ApplicationListener{
                 return;
             }
 
+            ReplayController.onConnect(packet.addressTCP);
             net.send(c, true);
         });
 
         net.handleClient(Disconnect.class, packet -> {
             if(quietReset) return;
 
+            ReplayController.stop();
             connecting = false;
             logic.reset();
             platform.updateRPC();
diff --git a/core/src/mindustry/net/Net.java b/core/src/mindustry/net/Net.java
index 6f9b8f9b50079b42f7762c8ee2b1101394b54e33..22b66b83cde27a73415b9154ed813cdfeb3d3b36 100644
--- a/core/src/mindustry/net/Net.java
+++ b/core/src/mindustry/net/Net.java
@@ -10,6 +10,7 @@ import mindustry.gen.*;
 import mindustry.net.Packets.*;
 import mindustry.net.Streamable.*;
 import mindustryX.events.*;
+import mindustryX.features.*;
 import net.jpountz.lz4.*;
 
 import java.io.*;
@@ -267,6 +268,7 @@ public class Net{
      */
     public void handleClientReceived(Packet object){
         object.handled();
+        ReplayController.onClientPacket(object);
 
         if(object instanceof StreamBegin b){
             streams.put(b.id, currentStream = new StreamBuilder(b));

From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: way-zer <himc.wicp@gmail.com>
Date: Sun, 19 May 2024 19:40:31 +0800
Subject: [PATCH] HC: ARC arcScanMode

---
 .../world/blocks/distribution/DirectionBridge.java   |  7 +++++++
 .../world/blocks/distribution/ItemBridge.java        | 12 ++++++++++++
 .../world/blocks/distribution/MassDriver.java        |  3 +++
 3 files changed, 22 insertions(+)

diff --git a/core/src/mindustry/world/blocks/distribution/DirectionBridge.java b/core/src/mindustry/world/blocks/distribution/DirectionBridge.java
index 2c0077cc99557c80f49d0cf496c92309b31e482e..341b81c8ec8cae795b3e5c3872e253f9317975bc 100644
--- a/core/src/mindustry/world/blocks/distribution/DirectionBridge.java
+++ b/core/src/mindustry/world/blocks/distribution/DirectionBridge.java
@@ -215,5 +215,12 @@ public class DirectionBridge extends Block{
             }
             return null;
         }
+        public boolean arcCheckAccept(Building source) {
+            //only accept if there's an output point.
+            if(findLink() == null) return false;
+
+            int rel = this.relativeToEdge(source.tile);
+            return rel != rotation && occupied[(rel + 2) % 4] == null;
+        }
     }
 }
diff --git a/core/src/mindustry/world/blocks/distribution/ItemBridge.java b/core/src/mindustry/world/blocks/distribution/ItemBridge.java
index 1b23be8356c7881fc5d0c38efdf245f6ee680c9c..0c31a143fd09888010517c31fea05f13c9b15c57 100644
--- a/core/src/mindustry/world/blocks/distribution/ItemBridge.java
+++ b/core/src/mindustry/world/blocks/distribution/ItemBridge.java
@@ -521,5 +521,17 @@ public class ItemBridge extends Block{
                 wasMoved = moved = read.bool();
             }
         }
+
+        public boolean arcLinkValid() {
+            return linkValid(this.tile, world.tile(link));
+        }
+
+        public boolean arcCheckDump(Building to){
+            return checkDump(to);
+        }
+
+        public boolean arcCheckAccept(Building source) {
+            return checkAccept(source, world.tile(link));
+        }
     }
 }
diff --git a/core/src/mindustry/world/blocks/distribution/MassDriver.java b/core/src/mindustry/world/blocks/distribution/MassDriver.java
index 636641924280a51603b22a7b5d777a3100d21b24..196b343e60cc046a270cc8f02c906d7276252fda 100644
--- a/core/src/mindustry/world/blocks/distribution/MassDriver.java
+++ b/core/src/mindustry/world/blocks/distribution/MassDriver.java
@@ -329,6 +329,9 @@ public class MassDriver extends Block{
             return other instanceof MassDriverBuild entity && other.isValid() && other.efficiency > 0 && entity.block == block && entity.link == pos() && within(other, range);
         }
 
+        public boolean arcLinkValid(){
+            return linkValid();
+        }
         protected boolean linkValid(){
             if(link == -1) return false;
             return world.build(this.link) instanceof MassDriverBuild other && other.block == block && other.team == team && within(other, range);

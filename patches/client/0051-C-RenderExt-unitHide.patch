From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: way-zer <himc.wicp@gmail.com>
Date: Thu, 4 Apr 2024 14:56:59 +0800
Subject: [PATCH] C(RenderExt) unitHide

---
 core/src/mindustry/input/Binding.java       | 2 +-
 core/src/mindustry/input/InputHandler.java  | 2 ++
 core/src/mindustryX/Hooks.java              | 4 ++++
 core/src/mindustryX/features/RenderExt.java | 4 ++++
 4 files changed, 11 insertions(+), 1 deletion(-)

diff --git a/core/src/mindustry/input/Binding.java b/core/src/mindustry/input/Binding.java
index 3a9f9845adbb5679a899e5c154349414942f1ed6..b4ddb5af181ffd4515f59b267b6558f1e84a337a 100644
--- a/core/src/mindustry/input/Binding.java
+++ b/core/src/mindustry/input/Binding.java
@@ -90,7 +90,7 @@ public enum Binding implements KeyBind{
     console(KeyCode.f8),
 
     //MDTX
-    mindustryX(KeyCode.unknown, "mindustryX"),
+    toggle_unit(KeyCode.unknown, "mindustryX"),
     ;
 
     private final KeybindValue defaultValue;
diff --git a/core/src/mindustry/input/InputHandler.java b/core/src/mindustry/input/InputHandler.java
index 0f86972de21272412e19b347ff3bae7a32dff502..6ad644550ad940c9be203835cc83e635ffa486a0 100644
--- a/core/src/mindustry/input/InputHandler.java
+++ b/core/src/mindustry/input/InputHandler.java
@@ -39,6 +39,7 @@ import mindustry.world.blocks.payloads.*;
 import mindustry.world.blocks.storage.*;
 import mindustry.world.blocks.storage.CoreBlock.*;
 import mindustry.world.meta.*;
+import mindustryX.features.*;
 
 import java.util.*;
 
@@ -1594,6 +1595,7 @@ public abstract class InputHandler implements InputProcessor, GestureListener{
     }
 
     public @Nullable Unit selectedUnit(){
+        if(RenderExt.unitHide) return null;
         Unit unit = Units.closest(player.team(), Core.input.mouseWorld().x, Core.input.mouseWorld().y, 40f, u -> u.isAI() && u.type.playerControllable);
         if(unit != null){
             unit.hitbox(Tmp.r1);
diff --git a/core/src/mindustryX/Hooks.java b/core/src/mindustryX/Hooks.java
index 0271b93974c79e5630148d2615ed81fe20800d97..b384d7525b403e589542379c62760c39e4f6e998 100644
--- a/core/src/mindustryX/Hooks.java
+++ b/core/src/mindustryX/Hooks.java
@@ -4,6 +4,7 @@ import arc.*;
 import arc.util.*;
 import mindustry.*;
 import mindustry.gen.*;
+import mindustry.input.*;
 import mindustryX.features.Settings;
 import mindustryX.features.*;
 
@@ -58,5 +59,8 @@ public class Hooks implements ApplicationListener{
 
     public static void pollKeys(){
         if(Core.scene.hasField()) return;
+        if(Core.input.keyTap(Binding.toggle_unit)){
+            RenderExt.unitHide = !RenderExt.unitHide;
+        }
     }
 }
diff --git a/core/src/mindustryX/features/RenderExt.java b/core/src/mindustryX/features/RenderExt.java
index 949ca69aa54504b8ec3e88c9f536a90396e605b4..23216764d050d0fa3969a18ff54c14145da841b8 100644
--- a/core/src/mindustryX/features/RenderExt.java
+++ b/core/src/mindustryX/features/RenderExt.java
@@ -23,6 +23,9 @@ public class RenderExt{
     public static int hiddenItemTransparency;
     public static int blockBarMinHealth;
     public static float overdriveZoneTransparency;
+
+    public static boolean unitHide = false;
+
     private static Effect placementEffect;
 
     public static void init(){
@@ -57,6 +60,7 @@ public class RenderExt{
     }
 
     public static void onGroupDraw(Drawc t){
+        if(unitHide && t instanceof Minerc) return;
         if(!bulletShow && t instanceof Bulletc) return;
         if(!showMineBeam && t instanceof Minerc) return;
         t.draw();

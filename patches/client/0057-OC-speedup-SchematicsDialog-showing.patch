From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: way-zer <himc.wicp@gmail.com>
Date: Sat, 3 Aug 2024 20:59:46 +0800
Subject: [PATCH] OC: speedup SchematicsDialog showing.

---
 build.gradle                                        | 2 +-
 core/src/mindustry/ui/dialogs/SchematicsDialog.java | 5 ++++-
 2 files changed, 5 insertions(+), 2 deletions(-)

diff --git a/build.gradle b/build.gradle
index 1a6cf5eb26635a2112d98ce2012cc666f3452a3f..273566d64e870371bb8d80d4569bce069316ce63 100644
--- a/build.gradle
+++ b/build.gradle
@@ -147,7 +147,7 @@ project(":core"){
         api "org.lz4:lz4-java:1.8.0"
         api arcModule("arc-core")
         api arcModule("extensions:flabel")
-        api arcModule("extensions:freetype")
+        api "com.github.way-zer.Arc:freetype:fe9f23ae08"
         api arcModule("extensions:g3d")
         api arcModule("extensions:fx")
         api arcModule("extensions:arcnet")
diff --git a/core/src/mindustry/ui/dialogs/SchematicsDialog.java b/core/src/mindustry/ui/dialogs/SchematicsDialog.java
index ff444b8991e2aa4d892bee3ab75757a5b1420c10..1d34fa3202a2f09e5a0840d74ca986c6b9aa74f9 100644
--- a/core/src/mindustry/ui/dialogs/SchematicsDialog.java
+++ b/core/src/mindustry/ui/dialogs/SchematicsDialog.java
@@ -675,6 +675,7 @@ public class SchematicsDialog extends BaseDialog{
     }
 
     public static class SchematicImage extends Image{
+        private static boolean setLock = false;
         public float scaling = 16f;
         public float thickness = 4f;
         public Color borderColor = Pal.gray;
@@ -700,7 +701,8 @@ public class SchematicsDialog extends BaseDialog{
                 && ((Button)parent.parent).isOver();
 
             boolean wasSet = set;
-            if(!set){
+            if(!set && !setLock){
+                setLock = true;
                 Core.app.post(this::setPreview);
                 set = true;
             }else if(lastTexture != null && lastTexture.isDisposed()){
@@ -731,6 +733,7 @@ public class SchematicsDialog extends BaseDialog{
         }
 
         private void setPreview(){
+            setLock = false;
             TextureRegionDrawable draw = new TextureRegionDrawable(new TextureRegion(lastTexture = schematics.getPreview(schematic)));
             setDrawable(draw);
             setScaling(Scaling.fit);

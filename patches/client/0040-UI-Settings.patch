From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: way-zer <himc.wicp@gmail.com>
Date: Thu, 28 Mar 2024 22:21:07 +0800
Subject: [PATCH] UI: Settings
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

修复蓝图大小问题
1c8c7803 way-zer <himc.wicp@gmail.com> on 2024/4/22 at 0:35
---
 core/assets/bundles/bundle-mdtx.properties | 28 ++++++++++++
 core/src/mindustryX/Hooks.java             |  3 ++
 core/src/mindustryX/features/Settings.java | 50 ++++++++++++++++++++++
 3 files changed, 81 insertions(+)
 create mode 100644 core/src/mindustryX/features/Settings.java

diff --git a/core/assets/bundles/bundle-mdtx.properties b/core/assets/bundles/bundle-mdtx.properties
index 14a2eb193c8bb0d3716414f31b4e223e30fdcdb2..ed99faa613a47518bbcea038b6f9d1e3df710594 100644
--- a/core/assets/bundles/bundle-mdtx.properties
+++ b/core/assets/bundles/bundle-mdtx.properties
@@ -41,6 +41,34 @@ stat.ammo_capacity = 子弹容量
 
 #end StatExt
 
+# Settings
+settings.category.mindustryX = MindustryX扩展
+setting.showUpdateDialog.name = 检测到新版MindustryX时提示
+setting.githubMirror.name = GitHub镜像加速(WZ镜像)    [gray]优化全球服务器列表及Mod浏览器功能
+
+category.arcReWork.name = Arc功能重置
+setting.replayRecord.name = 多人游戏录像    [gray]自动录制游玩过程，输出在saves文件夹
+setting.menuFloatText.name = 首页悬浮文字
+setting.showAdvanceToolTable.name = 工具箱(物品选择区左边)
+setting.researchViewer.name = 科技树透视器
+setting.minimapSize.name = 小地图大小
+setting.maxSchematicSize.name = 最大蓝图大小
+
+category.blockSettings.name = 建筑相关设置
+setting.staticShieldsBorder.name = 静止力墙边界
+setting.arcTurretPlaceCheck.name = [pink]炮台[white]：范围检查
+setting.arcchoiceuiIcon.name = [acid]装卸|分类[white]：显示物品图标
+setting.HiddleItemTransparency.name = [acid]带桥/交叉器内物品[white]：不透明度
+setting.overdrive_zone.name = [acid]超速范围[white]：不透明度
+setting.arcPlacementEffect.name = [pink]建筑放置特效
+setting.blockbarminhealth.name = [acid]建筑属性显示[white]：血量最低限制
+setting.blockRenderLevel.name = [cyan]建筑渲染等级
+
+category.entitySettings.name = 实体相关设置
+setting.bulletShow.name = 显示子弹
+setting.showminebeam.name = 显示单位挖掘光束
+#end Settings
+
 stat.reloadDetail = 装填：{0}%
 stat.warmupDetail = 充能：{0}%
 stat.ammoDetail = 弹药：{0}/{1}
diff --git a/core/src/mindustryX/Hooks.java b/core/src/mindustryX/Hooks.java
index 2d1aea2c9da5a511d34b2d7c6dde6993d6ff1518..f93bcf3ed1eee7d14f579eb527140ac696b80cdd 100644
--- a/core/src/mindustryX/Hooks.java
+++ b/core/src/mindustryX/Hooks.java
@@ -5,6 +5,7 @@ import arc.util.*;
 import mindustry.*;
 import mindustry.gen.*;
 import mindustryX.features.*;
+import mindustryX.features.Settings;
 
 import java.net.*;
 
@@ -12,6 +13,7 @@ public class Hooks implements ApplicationListener{
     /** invoke before `Vars.init`. Note that may be executed from `Vars.loadAsync` */
     public static void beforeInit(){
         Log.infoTag("MindustryX", "Hooks.beforeInit");
+        Settings.baseSettings();
     }
 
     /** invoke after loading, just before `Mod::init` */
@@ -20,6 +22,7 @@ public class Hooks implements ApplicationListener{
         Log.infoTag("MindustryX", "Hooks.init");
         RenderExt.init();
         ArcOld.addSettings();
+        Settings.addSettings();
         if(AutoUpdate.INSTANCE.getActive())
             AutoUpdate.INSTANCE.checkUpdate();
         if(!Vars.headless){
diff --git a/core/src/mindustryX/features/Settings.java b/core/src/mindustryX/features/Settings.java
new file mode 100644
index 0000000000000000000000000000000000000000..68332ec5d4c1934c5191320d948da5fd503782dc
--- /dev/null
+++ b/core/src/mindustryX/features/Settings.java
@@ -0,0 +1,50 @@
+package mindustryX.features;
+
+import arc.*;
+import mindustry.*;
+import mindustry.gen.*;
+
+import static mindustry.Vars.maxSchematicSize;
+
+public class Settings{
+    public static void baseSettings(){
+        int v = Core.settings.getInt("maxSchematicSize", maxSchematicSize);
+        maxSchematicSize = v == 257 ? Integer.MAX_VALUE : v;
+    }
+    public static void addSettings(){
+        var setting = Vars.ui.settings;
+        setting.addCategory("@settings.category.mindustryX", Icon.box, (c) -> {
+            c.checkPref("showUpdateDialog", true);
+            c.checkPref("githubMirror", false);
+
+            c.addCategory("arcReWork");
+            c.checkPref("replayRecord", false);
+            c.checkPref("menuFloatText", true);
+            c.checkPref("showAdvanceToolTable", false);
+            c.checkPref("researchViewer", false);
+            c.sliderPref("minimapSize", 140, 40, 400, 10, i -> i + "");
+            c.sliderPref("maxSchematicSize", 64, 64, 257, 1, v -> {
+                maxSchematicSize = v == 257 ? Integer.MAX_VALUE : v;
+                return v == 257 ? "无限" : String.valueOf(v);
+            });
+
+            c.addCategory("blockSettings");
+            c.checkPref("staticShieldsBorder", false);
+            c.checkPref("arcTurretPlaceCheck", false);
+            c.checkPref("arcchoiceuiIcon", false);
+            c.sliderPref("HiddleItemTransparency", 0, 0, 100, 2, i -> i > 0 ? i + "%" : "关闭");
+            c.sliderPref("overdrive_zone", 0, 0, 100, 2, i -> i > 0 ? i + "%" : "关闭");
+            c.checkPref("arcPlacementEffect", false);
+            c.sliderPref("blockbarminhealth", 0, 0, 4000, 50, i -> i + "[red]HP");
+            c.sliderPref("blockRenderLevel", 2, 0, 2, 1, s -> {
+                if(s > 1) return "全部显示";
+                if(s > 0) return "只显示建筑状态";
+                return "隐藏全部建筑";
+            });
+
+            c.addCategory("entitySettings");
+            c.checkPref("bulletShow", true);
+            c.checkPref("showMineBeam".toLowerCase(), true);
+        });
+    }
+}

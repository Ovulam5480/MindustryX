From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: way-zer <himc.wicp@gmail.com>
Date: Sat, 3 Aug 2024 20:59:46 +0800
Subject: [PATCH] OC: speedup SchematicsDialog showing.

---
 build.gradle                                        | 2 +-
 core/src/mindustry/ui/dialogs/SchematicsDialog.java | 5 ++++-
 2 files changed, 5 insertions(+), 2 deletions(-)

diff --git a/build.gradle b/build.gradle
index 04c82d033d92261996863efee84d0a3f4a3faadb..3f59dbbf8e758567ecfdc46eec7fe38359761da6 100644
--- a/build.gradle
+++ b/build.gradle
@@ -146,7 +146,7 @@ project(":core"){
         api "org.lz4:lz4-java:1.8.0"
         api arcModule("arc-core")
         api arcModule("extensions:flabel")
-        api arcModule("extensions:freetype")
+        api "com.github.way-zer.Arc:freetype:fe9f23ae08"
         api arcModule("extensions:g3d")
         api arcModule("extensions:fx")
         api arcModule("extensions:arcnet")
diff --git a/core/src/mindustry/ui/dialogs/SchematicsDialog.java b/core/src/mindustry/ui/dialogs/SchematicsDialog.java
index 3907f10dbee3695599e0f70bdfde13c34c53b50d..5095be6c1d92f1049829b96a34efabb9854f0e55 100644
--- a/core/src/mindustry/ui/dialogs/SchematicsDialog.java
+++ b/core/src/mindustry/ui/dialogs/SchematicsDialog.java
@@ -676,6 +676,7 @@ public class SchematicsDialog extends BaseDialog{
     }
 
     public static class SchematicImage extends Image{
+        private static boolean setLock = false;
         public float scaling = 16f;
         public float thickness = 4f;
         public Color borderColor = Pal.gray;
@@ -701,7 +702,8 @@ public class SchematicsDialog extends BaseDialog{
                 && ((Button)parent.parent).isOver();
 
             boolean wasSet = set;
-            if(!set){
+            if(!set && !setLock){
+                setLock = true;
                 Core.app.post(this::setPreview);
                 set = true;
             }else if(lastTexture != null && lastTexture.isDisposed()){
@@ -732,6 +734,7 @@ public class SchematicsDialog extends BaseDialog{
         }
 
         private void setPreview(){
+            setLock = false;
             TextureRegionDrawable draw = new TextureRegionDrawable(new TextureRegion(lastTexture = schematics.getPreview(schematic)));
             setDrawable(draw);
             setScaling(Scaling.fit);

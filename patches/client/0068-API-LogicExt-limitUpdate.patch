From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: way-zer <himc.wicp@gmail.com>
Date: Fri, 24 May 2024 19:45:32 +0800
Subject: [PATCH] API(LogicExt) limitUpdate

---
 core/src/mindustry/entities/EntityGroup.java | 12 ++++++++++++
 core/src/mindustryX/features/LogicExt.java   | 10 ++++++++++
 2 files changed, 22 insertions(+)

diff --git a/core/src/mindustry/entities/EntityGroup.java b/core/src/mindustry/entities/EntityGroup.java
index ea8ef0cdb8a30b54bb304543ea92dc99da44acb6..9c17cf445d723093d45e8b4e5181f86829d1798a 100644
--- a/core/src/mindustry/entities/EntityGroup.java
+++ b/core/src/mindustry/entities/EntityGroup.java
@@ -6,6 +6,7 @@ import arc.math.geom.*;
 import arc.struct.*;
 import arc.util.*;
 import mindustry.gen.*;
+import mindustryX.features.*;
 
 import java.util.*;
 
@@ -80,6 +81,17 @@ public class EntityGroup<T extends Entityc> implements Iterable<T>{
     }
 
     public void update(){
+        if(LogicExt.limitUpdate){
+            Core.camera.bounds(viewport);
+            viewport.grow(LogicExt.limitDst * 2);
+            for(index = 0; index < array.size; index++){
+                Entityc e = array.items[index];
+                if(e instanceof Position p && !viewport.contains(p.getX(), p.getY()))
+                    continue;
+                array.items[index].update();
+            }
+            return;
+        }
         for(index = 0; index < array.size; index++){
             array.items[index].update();
         }
diff --git a/core/src/mindustryX/features/LogicExt.java b/core/src/mindustryX/features/LogicExt.java
index e71f51b27d8576727f19b3273a9a6f0536e610c7..3d0141b5c308df84fea6c061d5b9e810e31b83fd 100644
--- a/core/src/mindustryX/features/LogicExt.java
+++ b/core/src/mindustryX/features/LogicExt.java
@@ -1,11 +1,21 @@
 package mindustryX.features;
 
 import arc.*;
+import mindustry.*;
 import mindustry.game.EventType.*;
 
 public class LogicExt{
+    public static boolean limitUpdate = false;
+    public static int limitDst = 0, limitTimer = 10;
+
     public static void init(){
         Events.run(Trigger.update, () -> {
+            limitUpdate = Core.settings.getBool("limitupdate");
+            limitDst = Core.settings.getInt("limitdst") * Vars.tilesize;
+            if(limitUpdate && limitTimer-- < 0){
+                limitUpdate = false;
+                limitTimer = 10;
+            }
         });
     }
 }
\ No newline at end of file

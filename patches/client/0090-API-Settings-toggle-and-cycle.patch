From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: way-zer <himc.wicp@gmail.com>
Date: Mon, 1 Jul 2024 13:32:57 +0800
Subject: [PATCH] API(Settings) toggle and cycle

---
 core/src/mindustryX/features/Settings.java    |  8 ++++++
 .../features/ui/AdvanceBuildTool.java         |  4 ++-
 .../features/ui/AdvanceToolTable.kt           |  3 ++-
 .../mindustryX/features/ui/ArcPowerInfo.java  |  5 ++--
 .../features/ui/HudSettingsTable.java         | 27 ++++++++++---------
 5 files changed, 29 insertions(+), 18 deletions(-)

diff --git a/core/src/mindustryX/features/Settings.java b/core/src/mindustryX/features/Settings.java
index ce902f8edad79e96f6f7b57fd2edd055ed1a55fd..1e24c02e81ff84f8d1c839e2e74699980004c0c4 100644
--- a/core/src/mindustryX/features/Settings.java
+++ b/core/src/mindustryX/features/Settings.java
@@ -74,4 +74,12 @@ public class Settings{
             Vars.ui.settings.getCategories().addAll(categories);
         });
     }
+
+    public static void toggle(String name){
+        Core.settings.put(name, !Core.settings.getBool(name));
+    }
+
+    public static void cycle(String name, int max){
+        Core.settings.put(name, (Core.settings.getInt(name) + 1) % max);
+    }
 }
diff --git a/core/src/mindustryX/features/ui/AdvanceBuildTool.java b/core/src/mindustryX/features/ui/AdvanceBuildTool.java
index d9e8b95289a7c197e089831ce82fda8519e8197b..8ab6555e466a128c0a24014391e424d62458b2de 100644
--- a/core/src/mindustryX/features/ui/AdvanceBuildTool.java
+++ b/core/src/mindustryX/features/ui/AdvanceBuildTool.java
@@ -23,6 +23,8 @@ import mindustry.world.blocks.logic.*;
 import mindustry.world.blocks.power.*;
 import mindustry.world.blocks.production.*;
 import mindustry.world.blocks.storage.*;
+import mindustryX.features.*;
+import mindustryX.features.Settings;
 import mindustryX.features.func.*;
 
 import static mindustry.Vars.*;
@@ -142,7 +144,7 @@ public class AdvanceBuildTool extends ToolTableBase{
                 });
             }).fillX().row();
             t.table(tt -> {
-                tt.button(Blocks.worldMessage.emoji(), flatTogglet, () -> Core.settings.put("displayallmessage", !Core.settings.getBool("displayallmessage", false))).checked(a -> Core.settings.getBool("displayallmessage")).size(30, 30).tooltip("开关信息板全显示");
+                tt.button(Blocks.worldMessage.emoji(), flatTogglet, () -> Settings.toggle("displayallmessage")).checked(a -> RenderExt.displayAllMessage).size(30, 30).tooltip("开关信息板全显示");
                 tt.button(Blocks.worldProcessor.emoji(), Styles.flatBordert, () -> {
                     showWorldProcessorInfo();
                     searchBlock = Blocks.worldProcessor;
diff --git a/core/src/mindustryX/features/ui/AdvanceToolTable.kt b/core/src/mindustryX/features/ui/AdvanceToolTable.kt
index d28fbe368126b3e44656f8fe7c1cb4d4d5d93edf..682ef3890b590fa34af775e1f71600547093d860 100644
--- a/core/src/mindustryX/features/ui/AdvanceToolTable.kt
+++ b/core/src/mindustryX/features/ui/AdvanceToolTable.kt
@@ -17,6 +17,7 @@ import mindustry.gen.Unit
 import mindustry.ui.Styles
 import mindustry.world.blocks.payloads.Payload
 import mindustryX.features.LogicExt
+import mindustryX.features.Settings
 import mindustryX.features.TimeControl
 import mindustryX.features.UIExt
 
@@ -90,7 +91,7 @@ class AdvanceToolTable : ToolTableBase() {
                     Reflect.invoke<Any>(Vars.ui.hudfrag.blockfrag, "rebuild")
                 }.checked { allBlocksReveal }
                     .tooltip("[acid]显示并允许建造所有物品").size(50f, 30f)
-                button("地形蓝图", Styles.flatToggleMenut) { Core.settings.put("terrainSchematic", !LogicExt.terrainSchematic) }
+                button("地形蓝图", Styles.flatToggleMenut) { Settings.toggle("terrainSchematic") }
                     .checked { LogicExt.terrainSchematic }.size(72f, 30f)
             }
 
diff --git a/core/src/mindustryX/features/ui/ArcPowerInfo.java b/core/src/mindustryX/features/ui/ArcPowerInfo.java
index d163c90f9969982e84dc8ea44faef92ba390686a..7f6737204adc9856a176f6f36e8b316dc6e74938 100644
--- a/core/src/mindustryX/features/ui/ArcPowerInfo.java
+++ b/core/src/mindustryX/features/ui/ArcPowerInfo.java
@@ -9,6 +9,7 @@ import mindustry.core.*;
 import mindustry.gen.*;
 import mindustry.graphics.*;
 import mindustry.ui.*;
+import mindustryX.features.Settings;
 
 //move from mindustry.arcModule.ui.PowerInfo
 public class ArcPowerInfo{
@@ -57,9 +58,7 @@ public class ArcPowerInfo{
         () -> Pal.powerBar,
         () -> stored / capacity);
 
-        power.clicked(() -> {
-            Core.settings.put("arccoreitems", (Core.settings.getInt("arccoreitems") + 1) % 4);
-        });
+        power.clicked(() -> Settings.cycle("arccoreitems",4));
         power.margin(0);
         power.add(powerBar).height(18).growX().padBottom(1);
         power.row();
diff --git a/core/src/mindustryX/features/ui/HudSettingsTable.java b/core/src/mindustryX/features/ui/HudSettingsTable.java
index c6b6d7e9922a86c029fbfeae57074fb21acbd81b..2ae0bd9c757eb5d5664fa0dec872938e1f1e4b0e 100644
--- a/core/src/mindustryX/features/ui/HudSettingsTable.java
+++ b/core/src/mindustryX/features/ui/HudSettingsTable.java
@@ -10,6 +10,7 @@ import mindustry.game.*;
 import mindustry.gen.*;
 import mindustry.ui.*;
 import mindustry.ui.dialogs.*;
+import mindustryX.features.Settings;
 import mindustryX.features.*;
 
 import static arc.Core.*;
@@ -35,7 +36,7 @@ public class HudSettingsTable extends ToolTableBase{
             t.button("[cyan]观", Styles.flatBordert, () -> Call.sendChatMessage("/ob")).size(30).tooltip("观察者模式");
             t.button("[cyan]技", Styles.flatBordert, () -> Call.sendChatMessage("/skill")).size(30).tooltip("技能！");
             t.button("[cyan]版", Styles.flatBordert, () -> Call.sendChatMessage("/broad")).size(30).tooltip("服务器信息版");
-            t.button("[red]版", Styles.flatTogglet, () -> settings.put("ShowInfoPopup", !Core.settings.getBool("ShowInfoPopup"))).checked(a -> Core.settings.getBool("ShowInfoPopup")).size(30, 30).tooltip("关闭所有信息版");
+            t.button("[red]版", Styles.flatTogglet, () -> Settings.toggle("ShowInfoPopup")).checked(a -> Core.settings.getBool("ShowInfoPopup")).size(30, 30).tooltip("关闭所有信息版");
             t.button("[white]法", Styles.flatBordert, () -> ui.showConfirm("受不了，直接投降？", () -> Call.sendChatMessage("/vote gameover"))).size(30, 30).tooltip("法国军礼");
             if(settings.getInt("arcQuickMsg", 0) == 0)
                 t.button("\uE87C", Styles.flatBordert, this::arcQuickMsgTable).size(30, 30).tooltip("快捷消息");
@@ -56,18 +57,18 @@ public class HudSettingsTable extends ToolTableBase{
             }).left().row();
         }
         cont.table(t -> {
-            t.button("[cyan]块", Styles.flatTogglet, () -> Core.settings.put("blockRenderLevel", (RenderExt.blockRenderLevel + 1) % 3))
+            t.button("[cyan]块", Styles.flatTogglet, () -> Settings.cycle("blockRenderLevel", 3))
             .checked((a) -> RenderExt.blockRenderLevel > 0).size(30, 30).tooltip("建筑显示");
             t.button("[cyan]兵", Styles.flatTogglet, () -> RenderExt.unitHide = !RenderExt.unitHide)
             .checked(a -> !RenderExt.unitHide).size(30, 30).tooltip("兵种显示");
-            t.button("[cyan]箱", Styles.flatTogglet, () -> Core.settings.put("unithitbox", !Core.settings.getBool("unithitbox")))
+            t.button("[cyan]箱", Styles.flatTogglet, () -> Settings.toggle("unithitbox"))
             .checked(a -> Core.settings.getBool("unithitbox")).size(30, 30).tooltip("碰撞箱显示");
-            t.button("[cyan]弹", Styles.flatTogglet, () -> Core.settings.put("bulletShow", !Core.settings.getBool("bulletShow")))
+            t.button("[cyan]弹", Styles.flatTogglet, () -> Settings.toggle("bulletShow"))
             .checked(a -> Core.settings.getBool("bulletShow")).size(30, 30).tooltip("子弹显示");
-            t.button("[cyan]" + Iconc.map, Styles.flatTogglet, () -> Core.settings.put("minimap", !Core.settings.getBool("minimap")))
+            t.button("[cyan]" + Iconc.map, Styles.flatTogglet, () -> Settings.toggle("minimap"))
             .checked(a -> Core.settings.getBool("minimap")).size(30, 30).tooltip("小地图显示");
             t.button("[violet]锁", Styles.flatTogglet, () -> {
-                Core.settings.put("removeLogicLock", !Core.settings.getBool("removeLogicLock"));
+                Settings.toggle("removeLogicLock");
                 control.input.logicCutscene = false;
                 ui.announce("已移除逻辑视角锁定");
             }).checked(a -> Core.settings.getBool("removeLogicLock")).size(30, 30).tooltip("逻辑锁定");
@@ -76,17 +77,17 @@ public class HudSettingsTable extends ToolTableBase{
             }).checked(a -> renderer.fogEnabled).size(30, 30).tooltip("战争迷雾").visible(() -> !state.rules.pvp || player.team().id == 255);
         }).left().row();
         cont.table(t -> {
-            t.button("[red]灯", Styles.flatTogglet, () -> settings.put("drawlight", !settings.getBool("drawlight")))
+            t.button("[red]灯", Styles.flatTogglet, () -> Settings.toggle("drawlight"))
             .checked(a -> state.rules.lighting).size(30, 30).name("灯光").tooltip("[cyan]开灯啊！");
-            t.button("[acid]效", Styles.flatTogglet, () -> Core.settings.put("effects", !Core.settings.getBool("effects")))
+            t.button("[acid]效", Styles.flatTogglet, () -> Settings.toggle("effects"))
             .checked(a -> Core.settings.getBool("effects")).size(30, 30).tooltip("特效显示");
             t.button("[acid]光", Styles.flatTogglet, () -> {
-                Core.settings.put("bloom", !Core.settings.getBool("bloom"));
+                Settings.toggle("bloom");
                 renderer.toggleBloom(settings.getBool("bloom"));
             }).checked(a -> Core.settings.getBool("bloom")).size(30, 30).tooltip("光效显示");
             t.button("[acid]墙", Styles.flatTogglet, () -> enableDarkness ^= true)
             .checked(a -> enableDarkness).size(30, 30).tooltip("墙体阴影显示");
-            t.button("[acid]天", Styles.flatTogglet, () -> Core.settings.put("showweather", !Core.settings.getBool("showweather")))
+            t.button("[acid]天", Styles.flatTogglet, () -> Settings.toggle("showweather"))
             .checked(a -> Core.settings.getBool("showweather")).size(30, 30).tooltip("天气显示");
             t.button("[cyan]扫", Styles.flatTogglet, () -> ArcScanMode.enabled = !ArcScanMode.enabled)
             .checked(a -> ArcScanMode.enabled).size(30, 30).tooltip("扫描模式");
@@ -194,7 +195,7 @@ public class HudSettingsTable extends ToolTableBase{
     public void sliderPref(String name, int min, int max, int step, StringProcessor s){
         Slider slider = new Slider(min, max, step, false);
         Label value = new Label("", Styles.outlineLabel);
-        slider.update(()->{
+        slider.update(() -> {
             slider.setValue(settings.getInt(name));
             value.setText(s.get((int)slider.getValue()));
         });
@@ -209,7 +210,7 @@ public class HudSettingsTable extends ToolTableBase{
         cont.stack(slider, content).width(Math.min(Core.graphics.getWidth() / 1.2f, 300f)).left().padTop(4f).get();
         cont.row();
 
-        if(settings.getDefault(name)==null)
+        if(settings.getDefault(name) == null)
             Log.warn("no default value for " + name);
     }
 
@@ -222,7 +223,7 @@ public class HudSettingsTable extends ToolTableBase{
         cont.add(box).left().padTop(0.5f);
         cont.row();
 
-        if(settings.getDefault(name)==null)
+        if(settings.getDefault(name) == null)
             Log.warn("no default value for " + name);
     }
 }

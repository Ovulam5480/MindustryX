From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: Anuken <arnukren@gmail.com>
Date: Tue, 3 Oct 2023 09:48:55 -0400
Subject: [PATCH] RailBulletType collision fixes

(cherry picked from commit ef83af5f1553ae32d2c996ae1d5e9e644e6965b4)
---
 .../mindustry/entities/bullet/RailBulletType.java  | 14 ++++----------
 1 file changed, 4 insertions(+), 10 deletions(-)

diff --git a/core/src/mindustry/entities/bullet/RailBulletType.java b/core/src/mindustry/entities/bullet/RailBulletType.java
index 9058d2cd90aa1839b06cba467f13158ecfba2749..fb5c1814a19ed7b2f24544441cb6992b8c578111 100644
--- a/core/src/mindustry/entities/bullet/RailBulletType.java
+++ b/core/src/mindustry/entities/bullet/RailBulletType.java
@@ -7,10 +7,6 @@ import mindustry.entities.*;
 import mindustry.gen.*;
 
 public class RailBulletType extends BulletType{
-    //for calculating the furthest point
-    static float furthest = 0;
-    static boolean any = false;
-
     public Effect pierceEffect = Fx.hitBulletSmall, pointEffect = Fx.none, lineEffect = Fx.none;
     public Effect endEffect = Fx.none;
 
@@ -55,10 +51,8 @@ public class RailBulletType extends BulletType{
 
         //bullet was stopped, decrease furthest distance
         if(b.damage <= 0f){
-            furthest = Math.min(furthest, b.dst(x, y));
+            b.fdata = Math.min(b.fdata, b.dst(x, y));
         }
-
-        any = true;
     }
 
     @Override
@@ -66,10 +60,8 @@ public class RailBulletType extends BulletType{
         super.init(b);
 
         b.fdata = length;
-        furthest = length;
-        any = false;
         Damage.collideLine(b, b.team, b.type.hitEffect, b.x, b.y, b.rotation(), length, false, false);
-        float resultLen = furthest;
+        float resultLen = b.fdata;
 
         Vec2 nor = Tmp.v1.trns(b.rotation(), 1f).nor();
         if(pointEffect != Fx.none){
@@ -78,6 +70,8 @@ public class RailBulletType extends BulletType{
             }
         }
 
+        boolean any = b.collided.size > 0;
+
         if(!any && endEffect != Fx.none){
             endEffect.at(b.x + nor.x * resultLen, b.y + nor.y * resultLen, b.rotation(), hitColor);
         }
